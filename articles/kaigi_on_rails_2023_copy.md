---
title: "【イベント参加レポート】Kaigi on Rails 2023"
emoji: "🛤️"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["Rails","kaigionrails"]
published: false
---

2023/10/27, 28 に行われた Kaigi on Rails の参加レポートになります。

## [Simplicity on Rails - RDB, REST and Ruby](https://speakerdeck.com/moro/simplicity-on-rails-rdb-rest-and-ruby)

### 参加目的

Railsの思想を改めて学習するため

### 登壇者

MOROHASHI Kyosuke 様

### 内容

- Railsの効果を最大限に得るためにはRailsが得意とするような設計をする必要がある
- **DB設計におけるイベントエンティティを見出す**
  - イベント：繰り返し行われる行為。ある時起こった<記録>
  - リソース：あるモノがある時に存在した、存在する<登録>
  - イベントエンティティを見出し、throughで指定して多対多の関係を作る
  - イベントエンティティからドメインを見返すことでドメイン上の大事な出来事をコードで表現できる
- コトをRESTリソースとして定義し、サービスの機能をそのCRUDで表現する
- 状態遷移も、URLへのアクセスで表現する
  - アプリケーション状態の遷移を、コトのリソースにまつわるページ遷移で表現する
- **RESTfulなフォームからやってくるものとDBの違いをRubyで吸収する**
  - Railsではエントリポイントにattributesを渡してファサードを呼ぶのが基本構造
  - 前後処理を挟む場合はActiveModelを使ってI/Fの近い別レイヤを導入する(ex:フォームオブジェクト,サービスクラス)
  - 複雑な処理はRubyとして複雑さに向き合う

### 感想

CRUDを主体としたRailsが得意とする設計について改めて学習することができた。
Form ObjectやService ClassといったFat Modelへの対応策について
「Rubyとして複雑さに向き合えば良い」といったコメントが印象的だった。

多々多のリレーションを持つテーブルおよびモデルをイベントエンティティという観点で捉える
ことも勉強になった。

## [seeds.rbを書かずに開発環境データを整備する](https://speakerdeck.com/gogutan/seeds-dot-rbwoshu-kazunikai-fa-huan-jing-detawozheng-bei-suru)

### 参加目的

開発で使用する共通データを用意する課題が発生していたため

### 登壇者

gogutan 様

### 内容

- ローカルで保管している開発環境のデータをCSVファイルに出力して必要なときにバルクインポートできるようにする
- 外部キー制約の問題でバルクインポートできない場合は該当テーブルを自動で後回しにした
- シーケンスオブジェクトを自動で修正できるようにした
- データの保存時刻は相対的に設定できるようにした

### 感想

外部キー制約が原因でそのままではデータを投入できないという問題への対応や
実行のたびに発生する問題に対して1つずつ解決していく様子が参考になった.

### [32個のPRでリリースした依存度の高いコアなモデルの安全な弄り方](https://speakerdeck.com/shoheimitani/32ge-noprderirisusitayi-cun-du-nogao-ikoanamoderunoan-quan-nanong-rifang)

### 参加目的

影響度の高いDBの定義修正をリリースする際の手順を学習するため

### 登壇者
Shohei Mitani 様

### 内容

- **オンラインDDL**
  - MySQL 5.6で追加された機能
  - DDLの実行中にロックを取得しないのでDMLが同時に行える
  - サービスを無停止でカラム追加などができる(オフラインになる操作もある)
  - 特別な設定は必要なく、対象のDDL操作は標準でオンライン DDLとなる
- オンラインDDLの注意点
  - 次のケースは非対象
    - オンラインDDL対象外のものが混ざったDDLステートメント
    - MySQL 5.5以前に作ったテーブルに対してのDDL
    - Generated Columnが存在するテーブルに対して、カラム位 置を指定して追加するケース
  - メタデータロック
    - DDLの対象テーブルに対して長期時間のロックを取得している処理がないか確認が必要
- カラム名の変更をする際にはカラムの追加 → 役割の置き換え → 古いカラムの削除の手順を踏む方が安全
- リリースする際には障害発生時の切り戻し範囲を極小化するようにする

### 感想

まずオンラインDDLをこれまで理解していなかったのでその点で勉強になった。
(必ずオンラインで実行されると誤認していた)
加えてリリースに向けて注意すべき点を整理し、対応策を考案した上で
実際にリリースしていく様子が勉強になった。

## [ペアプロしようぜ 〜3人で登壇!? 楽しくて速いペアプロ/モブプロ開発〜](https://speakerdeck.com/masuyama13/pair-mob-programming-kaigi-on-rails-2023)

### 参加目的

ペアプログラミングに興味があったため

### 登壇者

eatplaynap トミー 様
masuyama13 様
あんすと 様

### 内容
- ペアプログラミングとソロプログラミングの比較
  - 前者の方が開発時間は15%増えるが、不具合の発生率は15%低下する
- ペアプログラミングでの課題解決
  - slackの画面共有とペンツールを使用
  - 開始前に課題を洗い出す
  - こまめに休憩をとる
  - 時間を区切る
  - ドライバーではなく、タイピストという役割に変更してドライバーの負担を減らす
- 新メンバーのキャッチアップ速度上昇、属人化の低下、マージまでの日数減少の効果あり

### 感想
ユニークさという点ではトップクラスであった。
実際の発表内容についても、ペアプロの実際の進め方をリアルタイムで見ることができ、
自分でペアプロを実施する際の参考になった。
すぐにコーディングに取り掛かるのではなく、issueやタスクを整理してタイピストとナビの間で
共通認識を作る点が特に参考になった。

## [コードカバレッジ計測ツールを導入したらテストを書くのが楽しくなった話](https://speakerdeck.com/duckfalcon/kodokabaretuziji-ce-turuwodao-ru-sitaratesutowoshu-kunogale-sikunatutahua)

### 参加目的

テストのカバレッジ測定が開発課題となっていたため

### 登壇者

duck-falcon 様

### 内容

- コードカバレッジ：ソースコードがテストされた割合、テスト􏰀品質を保つため􏰀指標として使われる
- 計測方法
  - C0カバレッジ(命令網羅率):全ての命令が実行されれば100%
  - C1カバレッジ(分岐網羅率):全ての分岐を1度でも行えば100%
  - C2カバレッジ(条件網羅率):全ての条件の真偽が1度でも出れば100%
  - MCC(複合条件網羅率):全ての条件の真偽の組み合わせが出れば100%
  - C0,C1カバレッジ􏰀併用がおすすめ(PJ次第)
- カバレッジ率の目標値:80~95% 程度が良いとされている
- カバレッジ率の計測ツールを導入してもテストは書かれなかった
  - 新機能の追加やバグ修正が優先
- 新機能の追加やバグ修正でコードを読む際にテストを書くようにした
  - 労力を減らすのにカバレッジが活躍した
- チーム内でテストを書く意識が根付いた
  - 追加するテストの優先度決定にもカバレッジが役立った

### 感想

コードカバレッジを測定することの重要性はしばしば目にしていたが、
実際に可視化することでどのような効果をもたらすのかを知ることができた。
テストを書く意味は理解されているので、
長い眼でカバレッジを意識していくことが重要だと感じた。

